<!DOCTYPE html>
<html lang="en">

<head>
  <title>Thêm mới sản phẩm</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Main CSS-->
  <link rel="stylesheet" type="text/css" href="css/main.css">
  <!-- Font-icon css-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
  <!-- or -->
  <link rel="stylesheet" href="https://unpkg.com/boxicons@latest/css/boxicons.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
  <link rel="stylesheet" type="text/css"
    href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script type="text/javascript" src="/ckeditor/ckeditor.js"></script>
  <script src="http://code.jquery.com/jquery.min.js" type="text/javascript"></script>
  <script>

    function readURL(input, thumbimage) {
      if (input.files && input.files[0]) { //Sử dụng  cho Firefox - chrome
        var reader = new FileReader();
        reader.onload = function (e) {
          $("#thumbimage").attr('src', e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
      }
      else { // Sử dụng cho IE
        $("#thumbimage").attr('src', input.value);

      }
      $("#thumbimage").show();
      $('.filename').text($("#uploadfile").val());
      $('.Choicefile').css('background', '#14142B');
      $('.Choicefile').css('cursor', 'default');
      $(".removeimg").show();
      $(".Choicefile").unbind('click');

    }
    $(document).ready(function () {
      $(".Choicefile").bind('click', function () {
        $("#uploadfile").click();

      });
      $(".removeimg").click(function () {
        $("#thumbimage").attr('src', '').hide();
        $("#myfileupload").html('<input type="file" id="uploadfile"  onchange="readURL(this);" />');
        $(".removeimg").hide();
        $(".Choicefile").bind('click', function () {
          $("#uploadfile").click();
        });
        $('.Choicefile').css('background', '#14142B');
        $('.Choicefile').css('cursor', 'pointer');
        $(".filename").text("");
      });
    })
  </script>
</head>

<body class="app sidebar-mini rtl">
  <style>
    .Choicefile {
      display: block;
      background: #14142B;
      border: 1px solid #fff;
      color: #fff;
      width: 150px;
      text-align: center;
      text-decoration: none;
      cursor: pointer;
      padding: 5px 0px;
      border-radius: 5px;
      font-weight: 500;
      align-items: center;
      justify-content: center;
    }

    .Choicefile:hover {
      text-decoration: none;
      color: white;
    }

    #uploadfile,
    .removeimg {
      display: none;
    }

    #thumbbox {
      position: relative;
      width: 100%;
      margin-bottom: 20px;
    }

    .removeimg {
      height: 25px;
      position: absolute;
      background-repeat: no-repeat;
      top: 5px;
      left: 5px;
      background-size: 25px;
      width: 25px;
      /* border: 3px solid red; */
      border-radius: 50%;

    }

    .removeimg::before {
      -webkit-box-sizing: border-box;
      box-sizing: border-box;
      content: '';
      border: 1px solid red;
      background: red;
      text-align: center;
      display: block;
      margin-top: 11px;
      transform: rotate(45deg);
    }

    .removeimg::after {
      /* color: #FFF; */
      /* background-color: #DC403B; */
      content: '';
      background: red;
      border: 1px solid red;
      text-align: center;
      display: block;
      transform: rotate(-45deg);
      margin-top: -2px;
    }
    @media (max-width:991px) {
    .show{
    margin-left: 80px;
    }
  }
  @media (max-width:600px) {
    .show{
    margin-left: 0px;
    }
  }
  </style>
  <!-- Navbar-->
  <header class="app-header">
    <!-- Sidebar toggle button--><a class="app-sidebar__toggle" href="#" data-toggle="sidebar"
      aria-label="Hide Sidebar"></a>
    <!-- Navbar Right Menu-->
    <ul class="app-nav">


      <!-- User Menu-->
      <li><a class="app-nav__item" href="/index.html"><i class='bx bx-log-out bx-rotate-180'></i> </a>

      </li>
    </ul>
  </header>
  <!-- Sidebar menu-->
  <div class="app-sidebar__overlay" data-toggle="sidebar"></div>
  <aside class="app-sidebar">
    <div class="app-sidebar__user"><img class="app-sidebar__user-avatar" src="./images/admin.png" width="50px"
        alt="User Image">
      <div>
        <p class="app-sidebar__user-name"><b>ADMIN</b></p>
        <!-- <p class="app-sidebar__user-designation">Chào mừng bạn trở lại</p> -->
      </div>
    </div>
    <hr>
    <ul class="app-menu">
      <li><a class="app-menu__item " href="admin.html"><i class='app-menu__icon bx bx-tachometer'></i><span
            class="app-menu__label">Bảng điều khiển</span></a></li>
      <li><a class="app-menu__item " href="data-user.html"><i class='app-menu__icon bx bx-id-card'></i>
          <span class="app-menu__label">Quản lý khách hàng</span></a></li>
      <li><a class="app-menu__item active" href="data-product.html"><i
            class='app-menu__icon bx bx-purchase-tag-alt'></i>
          <span class="app-menu__label">Quản lý sản phẩm</span></a>
      </li>
      <li><a class="app-menu__item" href="data-oder.html"><i class='app-menu__icon bx bx-task'></i><span
            class="app-menu__label">Quản lý đơn hàng</span></a></li>
    </ul>
  </aside>
  <main class="app-content">
    <div class="app-title">
      <ul class="app-breadcrumb breadcrumb">
        <li class="breadcrumb-item"><a href="data-product.html">Danh sách sản phẩm</a> </li>
        <li class="breadcrumb-item"><a href="#">Thêm sản phẩm</a></li>
      </ul>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div class="tile">
          <h3 class="tile-title">Tạo mới sản phẩm</h3>
          <div class="tile-body">
            <div class="row element-button">
              <div class="col-sm-2">
                <a class="btn btn-add btn-sm" data-toggle="modal" data-target="#adddanhmuc"><i
                    class="fas fa-folder-plus" id="addOptionButton"></i> Chỉnh sửa danh mục</a>
              </div>
            </div>
            <form class="row">
              <div class="form-group col-md-3">
                <label for="list" class="control-label">Danh mục</label>
                <select class="form-control" id="list" onchange="makeCode()">
                  <!-- <option value="Khuyên tai">Khuyên tai</option>
                  <option value="Vòng cổ">Vòng cổ</option>
                  <option value="Túi xách">Túi xách</option>
                  <option value="Hoa cài tóc">Hoa cài tóc</option> -->
                </select>
              </div>
              <div class="form-group col-md-4">
                <label class="control-label">Tên sản phẩm</label>
                <input class="form-control" id="nameProduct" type="text">
              </div>
              <div class="form-group  col-md-2">
                <label class="control-label">Số lượng</label>
                <input class="form-control" id="quantity" type="number">
              </div>
              <div class="form-group col-md-3">
                <label class="control-label">Giá bán</label>
                <input class="form-control" id="price" type="number">
              </div>
              <div class="form-group col-md-12">
                <label class="control-label">Ảnh sản phẩm</label>
                <div id="myfileupload">
                  <input type="file" id="imageInput" name="ImageUpload">
                </div>
                <div id="thumbbox">
                  <img width="200" alt="preview" id="preview">
                </div>
                <!-- <div id="boxchoice">
                  <a href="javascript:" class="Choicefile"><i class="fas fa-cloud-upload-alt"></i> Chọn ảnh</a>
                  <p style="clear:both"></p>
                </div> -->

              </div>
              <div class="form-group col-md-12">
                <label class="control-label">Mô tả sản phẩm</label>
                <textarea class="form-control" name="mota" id="describe"></textarea>
              </div>

          </div>
          <button class="btn btn-save" type="button" onclick="saveProduct()">Lưu lại</button>
          <a class="btn btn-cancel" href="table-data-product.html">Hủy bỏ</a>
        </div>
  </main>




  <!--
  MODAL DANH MỤC
-->
  <div class="modal fade" id="adddanhmuc" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">

        <div class="modal-body">
          <div class="row">
            <div class="form-group  col-md-12">
              <span class="thong-tin-thanh-toan">
                <h5>Chỉnh sửa danh mục </h5>
              </span>
            </div>
            <div class="form-group col-md-12">
              <label class="control-label">Nhập tên danh mục mới</label>
              <input class="form-control" type="text" required id="newOption">
            </div>
            <div class="form-group col-md-12">
              <label class="control-label">Danh mục sản phẩm hiện đang có</label>
              <div class="row" style="padding-left: 20px;">
                <table id="listRender" style="width: 50%;text-align: center;margin: 0 auto;">

                </table>
                <!-- <li>Giày</li>
                <li>Khuyên tai</li>
                <li>Vòng cổ</li>
                <li>Túi xách</li>
                <li>Hoa cài tóc</li> -->
              </div>
            </div>
            <p id="newListNoti" style="margin: 0px 10px;color:red;font-size: 1.2rem;font-weight:500"></p>
          </div>
          <BR>
          <button class="btn btn-save" type="button" onclick="saveList()">Lưu lại</button>
          <a class="btn btn-cancel" data-dismiss="modal" href="#">Hủy bỏ</a>
          <BR>
        </div>
        <div class="modal-footer">
        </div>
      </div>
    </div>
  </div>
  <!--
MODAL
-->





  <!-- Load jQuery first -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <!-- Load Popper.js next -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <!-- Load Bootstrap JS last -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
  <script src="js/main.js"></script>


  <script>



    // Lấy thẻ hình ảnh từ HTML
    const imgElement = document.getElementById('preview');

    // Lắng nghe sự kiện onchange của input
    const imageInput = document.getElementById('imageInput');
    const myImage = document.getElementById('preview');

    imageInput.onchange = function (event) {
      const file = event.target.files[0];

      // Đọc tệp ảnh và chuyển đổi nó thành dữ liệu URL
      const reader = new FileReader();
      reader.onload = function (event) {
        const dataUrl = event.target.result;

        // Thiết lập nguồn ảnh của đối tượng ảnh với dữ liệu URL
        myImage.src = dataUrl;

        // Lưu dữ liệu URL vào local storage
        localStorage.setItem('myImage', dataUrl);

        // // Hiển thị ảnh
        // imgElement.src = dataUrl;
      };
      reader.readAsDataURL(file);
    };






    // tạo code ngẫu nhiên
    function makeCode() {
      var select = document.getElementById("list");
      var selectedOption = select.options[select.selectedIndex].value;
      var firstChar = selectedOption.charAt(0).toUpperCase();
      let random = Math.floor(Math.random() * 10000);
      let randomString = String(random).padStart(5, '0');
      return result = firstChar + randomString;
    }

    let listProduct = JSON.parse(localStorage.getItem("listProduct"));
    function saveProduct() {
      makeCode();
      let code = result;
      console.log(code);
      // document.getElementById("code").innerHTML = result
      let nameProduct = document.getElementById("nameProduct").value;
      let quantity = Number(document.getElementById("quantity").value);
      let list = document.getElementById("list").value;
      let price = Number(document.getElementById("price").value);
      let describe = document.getElementById("describe").value;
      let localStorageImage = localStorage.getItem("myImage");
      console.log(localStorageImage);
      if (listProduct == null) {
        listProduct = [];
      }
      //Kiểm tra xem mã code có trùng không?
      while (listProduct.find((s) => s.code === code)) {
        makeCode();
        code = result;
      }

      let product = {
        image: localStorageImage,
        name: nameProduct,
        code: code,
        quantity: quantity,
        status: "Còn hàng",
        list: list,
        price: price,
        describe: describe,
      }
      // Nếu mã sp trùng thì yêu cầu nhập lại
      // if (listProduct.find((s) => s.code === code && s.name === nameProduct && s.price === price)) {
      //   alert("Sản phẩm đã tồn tại!");
      //   return;
      // }
      // Cập nhập thông tin mới -> edit
      // let flagProduct = JSON.parse(localStorage.getItem("flagProduct"));
      // if (flagProduct != null) {
      //   listProduct.splice(flagProduct, 1, product);
      //   localStorage.removeItem("flagProduct");
      //   localStorage.setItem("listProduct", JSON.stringify(listProduct));
      //   render();
      //   return;
      // }

      listProduct.push(product);
      console.log(listProduct);
      localStorage.setItem("listProduct", JSON.stringify(listProduct));
      // render();
      setTimeout(function () {
        location.reload();
      }, 100);
    }
    let productList = JSON.parse(localStorage.getItem('productList'))
    // Lưu danh mục sản phẩm
    function saveList() {
      let productList = JSON.parse(localStorage.getItem('productList'))

      let newOptionInput = document.getElementById("newOption").value;
      if (newOptionInput == "") {
        document.getElementById("newListNoti").innerHTML = `Hãy nhập danh mục hàng mới!`
        return;
      }
      if (productList == null) {
        productList = [];
      }
      for (i = 0; i <= productList.length; i++) {
        if (productList[i] != newOptionInput) {
          productList.push(newOptionInput);
          localStorage.setItem("productList", JSON.stringify(productList));
          setTimeout(function () {
            location.reload();
          }, 100);
          renderList();
          return;
        }
        else {
          document.getElementById("newListNoti").innerHTML = `Danh mục hàng đã có!`
          return;
        }
      }
    }

    // In Danh mục sản phẩm
    function renderList() {
      let productList = JSON.parse(localStorage.getItem('productList'));
      console.log(productList);
      let resultList = "";
      for (i = 0; i < productList.length; i++) {
        resultList += `<tr>
                    <td style="border:none">${productList[i]}</td>
                    <td style="border:none"><button style="border:none; background-color:#fff" onclick="listDelete(${i})">
                      <i class="fas fa-trash-alt"></i> Xoá</button></td>
                  </tr>`
      }
      document.getElementById("listRender").innerHTML = resultList;
      let optionList="<option>-- Chọn danh mục --</option>"
      for (let index = 0; index < productList.length; index++) {
        optionList+=`<option>${productList[index]}</option>`;
      }
      document.getElementById("list").innerHTML=optionList;
    }
    renderList();

    function listDelete(id) {
      // console.log(listDelete);
      // let alertDeleteProduct = document.getElementById("toast")

      productList.splice(id, 1);
      localStorage.setItem("productList", JSON.stringify(productList));
      renderList();
    }



  </script>
</body>

</html>